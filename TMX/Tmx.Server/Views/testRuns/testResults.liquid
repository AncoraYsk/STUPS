<html>
    <head>
        <title>Test results</title>
        <style>
        table {
            border-collapse: collapse;
            width:100%;
        }
        
        td, th {
            border: 1px solid gray;
        }
        </style>
    </head>
    <body>
        <a href="/">Home</a>
        <br>
        <a href="/testRuns/testRuns">Test runs</a>
        <br>
        <br>
        
        <h1>{{ @Model.TestRun.Name }} /{{ @Model.TestRun.Status }}/</h1>
        
        <h2>Summary</h2>
        <table>
            <tr>
                <th style="width:35%">Story</th>
                <th style="width:10%">Platform</th>
                <th style="width:50%">Results</th>
                <th style="width:5%">Time spent</th>
            </tr>
            {% assign sortedTestSuites = @Model.Suites | sort:'id' %}
            {% for suite in sortedTestSuites %}
                {% if suite.status != 'NOT TESTED' %}
                    <tr>
                        <td style="width:35%"><a href="#{{ suite.Id }} {{ suite.Name }} {{ suite.Platform_Id }}">{{ suite.Name }}</a.</td>
                        <td style="width:10%">{{ suite.Platform_Id }}</td>
                        <td style="width:50%">
                            <table>
                                {% if suite.get_passed > 0 %}
                                    {% assign passedWidth = suite.get_passed | times:100 | divided_by:suite.get_all %}
                                    {% if passedWidth == 0 %} {{ assign passedWidth = 1 }} {% endif %}
                                    <td style="width:{{ passedWidth }}%; background-color:green; text-align:center">{{ suite.get_Passed }}</td>
                                {% endif %}
                                
                                {% if suite.get_Failed > 0 %}
                                    {% assign failedWidth = suite.get_Failed | times:100 | divided_by:suite.get_all %}
                                    {% if failedWidth == 0 %} {{ assign failedWidth = 1 }} {% endif %}
                                    <td style="width:{{ failedWidth }}%; background-color:red; text-align:center">{{ suite.get_Failed }}</td> 
                                {% endif %}
                                
                                {% if suite.get_passed_but_with_bad_smell > 0 %}
                                    {% assign smelledWidth = suite.get_Passed_But_With_Bad_Smell | times:100 | divided_by:suite.get_all %}
                                    {% if smelledWidth == 0 %} {{ assign smelledWidth = 1 }} {% endif %}
                                    <td style="width:{{ smelledWidth }}%; background-color:olive; text-align:center">{{ suite.get_Passed_But_With_Bad_Smell }}</td>
                                {% endif %}
                                
                                {% if suite.get_not_tested > 0 %}
                                    {% assign notTestedWidth = suite.get_Not_Tested | times:100 | divided_by:suite.get_all %}
                                    {% if notTestedWidth == 0 %} {{ assign notTestedWidth = 1 }} {% endif %}
                                    <td style="width:{{ notTestedWidth }}%; background-color:gray; text-align:center">{{ suite.get_Not_Tested }}</td>
                                {% endif %}
                            </table>
                        </td>
                        <td style="width:5%; text-align:right">{{ suite.time_spent }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </table>
        <br>
        <br>
        
        <h2>Detailed report</h2>
        <ul>
        {% for suite in @Model.TestRun.Test_Suites %}
            {% if suite.Name != 'autogenerated' %}
                {% case suite.Status %}
                {% when 'PASSED' %}
                    {% assign suiteColor = 'green' %}
                {% when 'FAILED' %}
                    {% assign suiteColor = 'red' %}
                {% when 'NOT TESTED' %}
                    {% assign suiteColor = 'gray' %}
                {% endcase %}
                <li><font style="color:{{ suiteColor }}"><a id="{{ suite.Id }} {{ suite.Name }} {{ suite.Platform_Id }}">{{ suite.Id }} {{ suite.Name }} {{ suite.Platform_Id }}</a></font></li>
            {% endif %}
            <ul>
            {% for scenario in suite.Test_Scenarios %}
                {% if scenario.Name != 'autogenerated' %}
                    {% case scenario.Status %}
                    {% when 'PASSED' %}
                        {% assign scenarioColor = 'green' %}
                    {% when 'FAILED' %}
                        {% assign scenarioColor = 'red' %}
                    {% when 'NOT TESTED' %}
                        {% assign scenarioColor = 'gray' %}
                    {% endcase %}
                    <li><font style="color:{{ scenarioColor }}">{{ scenario.Id }} {{ scenario.Name }} {{ scenario.Platform_Id }}</font></li>
                {% endif %}
                <ul>
                {% assign sortedTestResults = scenario.Test_Results | sort: 'Id' %}
                {% for result in sortedTestResults %}
                    {% if result.Origin == 'Logical' %}
                        {% case result.Status %}
                        {% when 'PASSED' %}
                            {% assign resultColor = 'green' %}
                        {% when 'FAILED' %}
                            {% assign resultColor = 'red' %}
                        {% when 'NOT TESTED' %}
                            {% assign resultColor = 'gray' %}
                        {% when 'KNOWN ISSUE' %}
                            {% assign resultColor = 'olive' %}
                        {% endcase %}
                        <li><font style="color:{{ resultColor }}">{{ result.Id }} {{ result.Name }}</font></li>
                    {% endif %}
                    <ul>
                    {% for detail in result.Test_Result_Details %}
                        <li><font style="color:{{ resultColor }}">{{ detail }}</font></li>
                    {% endfor %}
                    </ul>
                {% endfor %}
                </ul>
            {% endfor %}
            </ul>
        {% endfor %}
        </ul>
    </body>
</html>